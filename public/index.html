<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropzone File Upload</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.css">
</head>

<body>
    <h1>Form with Dropzone.js</h1>

    <!-- Dropzone ì˜ì—­ -->


    <form id="my-dropzone" class="dropzone">
        <div class="dz-message">Drop files here or click to upload</div>
    </form>
    <button id="upBtn">Submit</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.js"></script>
    <script>
        Dropzone.autoDiscover = false;

        // Dropzone ì„¤ì •
        const myDropzone = new Dropzone("#my-dropzone", {
            autoProcessQueue: false,
            url: "/updateFiles", // Node.js ë°±ì—”ë“œì˜ ì—…ë¡œë“œ ê²½ë¡œ
            paramName: "profileImg", // Multerì— ì§€ì •í•œ í•„ë“œ ì´ë¦„ê³¼ ì¼ì¹˜
            uploadMultiple: false, // ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ
            maxFilesize: 5, // ìµœëŒ€ íŒŒì¼ í¬ê¸°: 5MB
            parallelUploads: 5,// ë™ì‹œì— ì—…ë¡œë“œí•  íŒŒì¼ ìˆ˜
            acceptedFiles: "image/*", // ì´ë¯¸ì§€ íŒŒì¼ë§Œ í—ˆìš©
            addRemoveLinks: true, // íŒŒì¼ ì‚­ì œ ë§í¬

            init: function () {
                this.on("addedfile", (file) => {
                    console.log("ğŸš€ íŒŒì¼ ì¶”ê°€:", file.name);

                    initialFileCount = this.files.length; // í˜„ì¬ íŒŒì¼ ê°œìˆ˜ ì¶”ì 
                    console.log("ğŸš€ ~ FileCount:", initialFileCount)

                });
                this.on("removedfile", (file) => {
                    if (isResetting) {
                        // Dropzone ì´ˆê¸°í™”ë¡œ ì¸í•´ ì‚­ì œëœ ê²½ìš° ë¡œê·¸ ì¶œë ¥ ìƒëµ
                        return;
                    }
                    console.log("ğŸš€ íŒŒì¼ ì‚­ì œ:", file.name);
                    initialFileCount = this.files.length; // íŒŒì¼ ì‚­ì œ í›„ íŒŒì¼ ê°œìˆ˜ ê°±ì‹ 
                });

                this.on("queuecomplete", () => {
                    console.log("ğŸš€ ëª¨ë“  íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ");
                    alert("ëª¨ë“  íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ");

                    // Dropzone ì´ˆê¸°í™”
                    isResetting = true; // ì´ˆê¸°í™” ì‹œì‘
                    myDropzone.removeAllFiles(true); // ëª¨ë“  íŒŒì¼ ì œê±°
                    console.log("ğŸš€ Dropzone ì´ˆê¸°í™” ì™„ë£Œ");
                    isResetting = false; // ì´ˆê¸°í™” ì¢…ë£Œ
                });
                this.on("success", (file, response) => {
                    console.log("ğŸš€ ì—…ë¡œë“œ ì„±ê³µ - íŒŒì¼:", file.name);
                    console.log("json:", response);
                });
                this.on("error", (file, errorMessage) => {
                    console.log("ğŸš€ ì—…ë¡œë“œ ì‹¤íŒ¨:", errorMessage);
                });
                this.on("error", (file, errorMessage, xhr) => {
                    console.log("ğŸš€ ì—…ë¡œë“œ ì‹¤íŒ¨ - íŒŒì¼:", file.name);
                    try {
                        const errorResponse = JSON.parse(xhr.responseText);
                        console.log("âŒ(JSON):", errorResponse);
                    } catch (e) {
                        console.error("âŒì„ JSONìœ¼ë¡œ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:", xhr.responseText);
                    }
                });
            },
        });

        document.getElementById("upBtn").addEventListener("click", () => {// ì—…ë¡œë“œ ë²„íŠ¼ ë™ì‘
            if (myDropzone.files.length === 0) {
                alert("íŒŒì¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.");
                return;
            }
            myDropzone.processQueue(); // íì— ìˆëŠ” íŒŒì¼ ì—…ë¡œë“œ
        });
    </script>
</body>

</html>